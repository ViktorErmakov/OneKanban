---
sidebar_position: 3
---

# Конфигурация "СППР"


## Заимствование объектов основной конфигурации

- Справочник `Проекты`
- Справочник `ЗадачиПроцесса`
    - Реквизит `Исполнитель`
    - Реквизит `Статус`
    - Реквизит `Предмет`
- Справочник `ТехническиеПроекты`
- Справочник `Ошибки`
    - Реквизит `КомуНаправлена`
    - Реквизит `Статус`
- Перечисление `СтатусыЗадачПроцессов`
- Перечисление `СтатусыОшибок`
- Определяемый тип `ПредметПроцесса`

## Определяемые типы

Необходимо установить типы для:
- `канбан_Задачи` - справочник с задачами **СправочникСсылка.ЗадачиПроцесса**
- `канбан_Пользователь` - справочник Пользователи (БСП) **СправочникСсылка.Пользователи**
- `канбан_Проекты` - справочник проектов **СправочникСсылка.Проекты**
- `канбан_СтатусыЗадач` - справочник статусов задач **ПеречислениеСсылка.СтатусыЗадачПроцессов**

## Переопределяемые модули

:::info

Расширение содержит готовый код переопределяемых методов для текущей конфигурации

:::

### ОМ канбан_КанбанДоскаПереопределяемый

#### ТекстЗапросаДанныеЗадач()

Необходимо указать основной текст запроса разрешенных задач для получения слудующих полей:

* Задача - ОпределяемыйТип.канбан_Задачи - ссылка на задачу
* КодЗадачи - Число, Строка - код задачи
* СтатусЗадачи - ОпределяемыйТип.канбан_СтатусыЗадач
* ХранилищеФотографии - ХранилищеЗначения - фотография исполнителя задачи.
* НаименованиеЗадачи - Строка - наименование задачи
* Проект - ОпределяемыйТип.канбан_Проекты
* Исполнитель - ОпределяемыйТип.канбан_Пользователь

Возвращаемое значение: Строка

```bsl title="ТекстЗапросаДанныеЗадач"
Запрос.Текст =
    "ВЫБРАТЬ РАЗРЕШЕННЫЕ
    |	Задачи.Ссылка КАК Задача,
    |	Задачи.Код КАК КодЗадачи,
    |	Задачи.Статус КАК СтатусЗадачи,
    |	ЕСТЬNULL(Пользователи.Фотография, """") КАК ХранилищеФотографии,
    |	Задачи.Наименование КАК НаименованиеЗадачи,
    |	ЕСТЬNULL(Проекты.Ссылка, ЗНАЧЕНИЕ(Справочник.Проекты.ПустаяСсылка)) КАК Проект,
    |	ЕСТЬNULL(Задачи.Исполнитель, ЗНАЧЕНИЕ(Справочник.Пользователи.ПустаяСсылка)) КАК Исполнитель,
    |	ЕСТЬNULL(Проекты.Код, """") КАК КодПроекта,
    |	ЕСТЬNULL(Проекты.Наименование, """") КАК НаименованиеПроекта,
    |	УНИКАЛЬНЫЙИДЕНТИФИКАТОР(Проекты.Ссылка) КАК УникальныйИдентификаторПроекта
    |ПОМЕСТИТЬ Объединение
    |ИЗ
    |	Справочник.ЗадачиПроцесса КАК Задачи
    |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Пользователи КАК Пользователи
    |		ПО Задачи.Исполнитель = Пользователи.Ссылка
    |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ТехническиеПроекты КАК ТехническиеПроекты
    |			ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Проекты КАК Проекты
    |			ПО ТехническиеПроекты.Владелец = Проекты.Ссылка
    |		ПО Задачи.Предмет = ТехническиеПроекты.Ссылка
    |
    |ОБЪЕДИНИТЬ ВСЕ
    |
    |ВЫБРАТЬ
    |	Ошибки.Ссылка,
    |	Ошибки.Код,
    |	Ошибки.Статус,
    |	ЕСТЬNULL(Пользователи.Фотография, """"),
    |	Ошибки.Наименование,
    |	ЕСТЬNULL(Ошибки.Владелец.Ссылка, ЗНАЧЕНИЕ(Справочник.Проекты.ПустаяСсылка)),
    |	ЕСТЬNULL(Ошибки.КомуНаправлена, ЗНАЧЕНИЕ(Справочник.Пользователи.ПустаяСсылка)),
    |	ЕСТЬNULL(Проекты.Код, """"),
    |	ЕСТЬNULL(Проекты.Наименование, """"),
    |	УНИКАЛЬНЫЙИДЕНТИФИКАТОР(Проекты.Ссылка)
    |ИЗ
    |	Справочник.Ошибки КАК Ошибки
    |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Пользователи КАК Пользователи
    |		ПО Ошибки.КомуНаправлена = Пользователи.Ссылка
    |		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Проекты КАК Проекты
    |		ПО Ошибки.Владелец = Проекты.Ссылка
    |;
    |
    |////////////////////////////////////////////////////////////////////////////////
    |ВЫБРАТЬ
    |	Объединение.Задача КАК Задача,
    |	Объединение.КодЗадачи КАК КодЗадачи,
    |	Объединение.СтатусЗадачи КАК СтатусЗадачи,
    |	Объединение.ХранилищеФотографии КАК ХранилищеФотографии,
    |	Объединение.НаименованиеЗадачи КАК НаименованиеЗадачи,
    |	Объединение.Проект КАК Проект,
    |	Объединение.Исполнитель КАК Исполнитель,
    |	Объединение.КодПроекта КАК КодПроекта,
    |	Объединение.НаименованиеПроекта КАК НаименованиеПроекта,
    |	Объединение.УникальныйИдентификаторПроекта КАК УникальныйИдентификаторПроекта
    |ИЗ
    |	Объединение КАК Объединение";
```

#### ТекстЗапросаСтатусы()

Необходимо указать текст запроса разрешенных статусов для получения следующих полей:

* Статус - ОпределяемыйТип.канбан_СтатусыЗадач
* Представление - Строка - представление статуса для канбан доски
* УникальныйИдентификатор - Строка

 Возвращаемое значение: Строка

```bsl title="ТекстЗапросаСтатусы"
ПРЕДСТАВЛЕНИЕССЫЛКИ
Запрос.Текст =
    "ВЫБРАТЬ РАЗРЕШЕННЫЕ
    |	СтатусыЗадачи.Ссылка КАК Статус,
    |	ПРЕДСТАВЛЕНИЕССЫЛКИ(СтатусыЗадачи.Ссылка) КАК Представление,
    |	ПРЕДСТАВЛЕНИЕССЫЛКИ(СтатусыЗадачи.Ссылка) КАК УникальныйИдентификатор
    |ИЗ
    |	&ОбъектЗапроса КАК СтатусыЗадачи";
```

#### ИзменитьСтатусЗадаче(Задача, Статус, Отказ)

Принимаемые параметры:
 * Задача - ОпределяемыйТип.канбан_Задачи
 * Статус - ОпределяемыйТип.канбан_СтатусыЗадач - устанавливаемый статус
 * Отказ  - Булево

Метод должен изменить статус для указанной задачи.

```bsl title="ИзменитьСтатусЗадаче"
Попытка
    
    ЗадачаОбъект = Задача.ПолучитьОбъект();
    
    ЗадачаОбъект.Заблокировать();
    
    ЗадачаОбъект.Статус = Статус;
    
    ЗадачаОбъект.Записать();
    
Исключение
    
    Отказ = Истина;
    
    ЗаписьЖурналаРегистрации(
        "ТипОперации", 
        УровеньЖурналаРегистрации.Ошибка,, 
        "Текст", 
        ОбработкаОшибок.ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
        
    ВызватьИсключение;
    
КонецПопытки;
```

#### СтатусЗадачиПоИдентификатору(ИдентификаторСтатусаСтрока, СтатусСсылка)

Принимаемые параметры:
 * ИдентификаторСтатусаСтрока - Строка
 * СтатусСсылка - ОпределяемыйТип.канбан_СтатусыЗадач

Метод должен найти по переданному параметру **ИдентификаторСтатусаСтрока** элемент справочника Статус
и поместить результат в параметр **СтатусСсылка**

```bsl title="ИзменитьСтатусЗадаче"
СтатусСсылка = Перечисления["СтатусыЗадачПроцессов"][ИдентификаторСтатусаСтрока];
```

### ОМ канбан_КанбанДоскаКлиентПереопределяемый

#### СобытияОбработкиОповещения(События)

Принимаемые параметры:
 * События - Массив из Строка

В методе можно дополнить список событий обработки оповещения при которых нужно обновить доску.

```bsl title="СобытияОбработкиОповещения"
События.добавить("СправочникЗадачаЗаписана")
```